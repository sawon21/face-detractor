<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Detective - Register</title>

    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome for Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #ff9966, #ff5e62);
            color: #fff;
            text-align: center;
            min-height: 100vh;
        }
    #modal{
      color: red;
      font-weight: bold;
      font-size:20px;
    }
        .header {
            width: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 15px 0;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1000;
        }
        .header h1 {
            font-size: 1.5rem;
            margin: 0;
            color: #fff;
        }
        .header .btn {
            margin: 5px;
            font-size: 0.9rem; /* Medium size for mobile */
        }
        .container {
            max-width: 600px;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            margin-top: 80px; /* To avoid overlap with the header */
        }
        .container h1 {
            font-size: 1.8rem; /* Adjusted for mobile */
            margin-bottom: 20px;
            color: #fff;
        }
        .form-control {
            border-radius: 30px;
            padding: 10px; /* Adjusted padding */
            margin-bottom: 15px; /* Adjusted margin */
        }
        .live-preview {
            width: 100%;
            height: 300px;
            border: 2px solid #fff;
            border-radius: 20px;
            margin-bottom: 15px; /* Adjusted margin */
            object-fit: cover;
        }
        .btn {
            padding: 10px;
            font-size: 0.9rem; /* Medium size */
            border-radius: 30px;
            transition: transform 0.3s;
            width: 35%;
            margin-bottom: 10px; /* Add space between buttons */
        }
        .btn:hover {
            transform: scale(1.1);
        }
        @media (max-width: 576px) {
            .header {
                padding: 10px 0;
            }
            .header h1 {
                font-size: 1.2rem; /* Smaller font size for mobile */
            }
            .container {
                padding: 20px; /* Adjust padding for mobile */
            }
            .container h1 {
                font-size: 1.5rem; /* Smaller title for mobile */
            }
        }
    </style>
</head>
<body>

    <!-- Header with Navigation -->
    <div class="header">
        <h1>Face Detective</h1>
        <div>
            <a href="index.html" class="btn btn-outline-light">Home</a>
            <a href="recognition.html" class="btn btn-outline-light">Recognize Face</a>
        </div>
    </div>

    <!-- Registration Form Container -->
    <div class="container">
        <h1>Register Student</h1>
        
        <!-- Form -->
        <form id="registrationForm">
            <div class="form-group">
                <label for="name"><i class="fas fa-user"></i> Name</label>
                <input type="text" id="name" class="form-control" placeholder="Enter Student Name" required>
            </div>
            <div class="form-group">
                <label for="roll"><i class="fas fa-id-badge"></i> Roll Number</label>
                <input type="text" id="roll" class="form-control" placeholder="Enter Roll Number" required>
            </div>
            <div class="form-group">
                <label for="department"><i class="fas fa-building"></i> Department</label>
                <select id="department" class="form-control" required>
                    <option value="">Select Department</option>
                    <option value="Science">Science</option>
                    <option value="Arts">Arts</option>
                    <option value="Commerce">Commerce</option>
                </select>
            </div>

            <!-- Live Camera Preview -->
            <label><i class="fas fa-camera"></i> Live Face Preview</label>
            <video id="video" class="live-preview" autoplay></video>

            <!-- Capture and Save Buttons -->
            <div class="btn-group mt-4">
                <button type="button" class="btn btn-primary" id="captureBtn"><i class="fas fa-camera-retro"></i> Capture</button>
                <button type="button" class="btn btn-success" id="saveDataBtn"><i class="fas fa-save"></i> Save Data</button>
                <button type="button" class="btn btn-info" id="generatePdfBtn"><i class="fas fa-file-pdf"></i> Generate Data PDF</button>
            </div>
        </form>
    </div>
<!-- Bootstrap Modal -->
<div class="modal fade" id="modal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalLabel">Modal Title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">Modal body text goes here.</div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Camera Access and Data Saving Script -->
    <script>
      // Camera Access and Data Saving Script
const video = document.getElementById('video');
navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => {
        video.srcObject = stream;
    })
    .catch(err => {
        console.error('Camera not accessible', err);
    });

const captureBtn = document.getElementById('captureBtn');
const canvas = document.createElement('canvas');
captureBtn.addEventListener('click', () => {
    const context = canvas.getContext('2d');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    context.drawImage(video, 0, 0, canvas.width, canvas.height);
    const imageData = canvas.toDataURL('image/png');
    localStorage.setItem('capturedImage', imageData);
    showModal('Face Captured', 'Your face has been captured successfully!');
});

const saveDataBtn = document.getElementById('saveDataBtn');
saveDataBtn.addEventListener('click', () => {
    const name = document.getElementById('name').value;
    const roll = document.getElementById('roll').value;
    const department = document.getElementById('department').value;
    const faceData = localStorage.getItem('capturedImage');

    if (name && roll && department && faceData) {
        const studentData = {
            name,
            roll,
            department,
            face: faceData,
        };

        // Retrieve existing students data or initialize an empty array
        const existingData = JSON.parse(localStorage.getItem('studentsData')) || [];
        existingData.push(studentData);
        localStorage.setItem('studentsData', JSON.stringify(existingData));
        showModal('Data Saved', 'Student data saved successfully!');
        document.getElementById('registrationForm').reset(); // Reset form after saving
    } else {
        showModal('Error', 'Please complete the form and capture the face.');
    }
});

// Show Bootstrap Modal Function
function showModal(title, message) {
    const modal = document.getElementById('modal');
    modal.querySelector('.modal-title').innerText = title;
    modal.querySelector('.modal-body').innerText = message;
    $('#modal').modal('show');
}

// Generate PDF with all Student Data
const generatePdfBtn = document.getElementById('generatePdfBtn');
generatePdfBtn.addEventListener('click', () => {
    const studentsData = JSON.parse(localStorage.getItem('studentsData'));
    if (studentsData && studentsData.length > 0) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        doc.setFontSize(16);
        doc.text('Student Data', 20, 20);
        doc.setFontSize(12);
        const data = [
            ["Serial Number", "Name", "Roll", "Department", "Image"],
        ];

        studentsData.forEach((student, index) => {
            data.push([index + 1, student.name, student.roll, student.department, student.face]);
        });

        // Add table
        const startY = 30;
        const columnWidths = [40, 40, 40, 40, 40];
        const lineHeight = 30;

        data.forEach((row, index) => {
            row.forEach((cell, colIndex) => {
                if (colIndex === 4) {
                    // Add image in the last column
                    const img = new Image();
                    img.src = cell;
                    img.onload = function() {
                        const x = 160;
                        const y = startY + (index * lineHeight);
                        doc.addImage(img, 'PNG', x, y, 30, 30);
                        if (index === data.length - 1) {
                            doc.save('student_data.pdf'); // Save the PDF after all images are added
                        }
                    };
                } else {
                    doc.text(cell.toString(), (colIndex * columnWidths[colIndex]) + 20, startY + (index * lineHeight));
                }
            });
        });
    } else {
        showModal('Error', 'No student data found. Please save data first.');
    }
});
    </script>
</body>
</html>